<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Bajere" />
  <meta name="theme-color" content="#0a0a0f" />
  <title>Hvor mange genstande?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #d4af37;
      --gold-light: #f4d03f;
      --gold-dark: #b8860b;
      --bg: #0a0a0f;
      --text: #ffffff;
      --text-sub: rgba(255,255,255,0.65);
      --text-muted: rgba(255,255,255,0.4);
      --border: rgba(212,175,55,0.22);
      --glass: rgba(255,255,255,0.055);
      --glass-border: rgba(255,255,255,0.1);
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

    html, body {
      height: 100%;
      overflow: hidden;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      -webkit-font-smoothing: antialiased;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
    }

    /* ‚îÄ‚îÄ Background glow ‚îÄ‚îÄ */
    .bg-glow {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      background:
        radial-gradient(ellipse 70% 50% at 20% 10%, rgba(212,175,55,.09) 0%, transparent 70%),
        radial-gradient(ellipse 60% 60% at 80% 90%, rgba(212,175,55,.06) 0%, transparent 70%);
      animation: glowShift 18s ease-in-out infinite alternate;
    }
    @keyframes glowShift {
      0%   { opacity: 1; transform: scale(1) translate(0,0); }
      100% { opacity: .8; transform: scale(1.08) translate(1%, 1.5%); }
    }

    /* ‚îÄ‚îÄ Dot progress ‚îÄ‚îÄ */
    .dots {
      position: fixed;
      top: calc(18px + env(safe-area-inset-top));
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 200;
      opacity: 0;
      transition: opacity .3s;
    }
    .dots.visible { opacity: 1; }
    .dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--glass-border);
      transition: background .4s, transform .4s;
    }
    .dot.active {
      background: var(--gold);
      transform: scale(1.4);
      box-shadow: 0 0 8px var(--gold);
    }
    .dot.done {
      background: rgba(212,175,55,.45);
    }

    /* ‚îÄ‚îÄ Lock button ‚îÄ‚îÄ */
    .lock-btn {
      position: fixed;
      top: calc(12px + env(safe-area-inset-top));
      right: 20px;
      z-index: 200;
      width: 36px; height: 36px;
      border-radius: 50%;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      color: var(--text-muted);
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: color .2s, border-color .2s;
    }
    .lock-btn.visible { display: flex; }
    .lock-btn:active { color: var(--gold); border-color: var(--gold); }

    /* ‚îÄ‚îÄ Screen container ‚îÄ‚îÄ */
    .screens {
      position: fixed; inset: 0; z-index: 10;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ Each screen ‚îÄ‚îÄ */
    .screen {
      position: absolute; inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 32px 28px;
      padding-top: calc(72px + env(safe-area-inset-top));
      padding-bottom: calc(32px + env(safe-area-inset-bottom));

      /* hidden right by default */
      transform: translateX(100%) scale(.96);
      opacity: 0;
      pointer-events: none;
      /* NO transition on default ‚Äî handled per-state */
    }
    .screen.slide-in {
      transition:
        transform .42s cubic-bezier(.32,.72,0,1),
        opacity   .42s cubic-bezier(.32,.72,0,1);
      transform: translateX(0) scale(1);
      opacity: 1;
      pointer-events: auto;
    }
    .screen.slide-out-left {
      transition:
        transform .38s cubic-bezier(.4,0,.6,1),
        opacity   .38s cubic-bezier(.4,0,.6,1);
      transform: translateX(-28%) scale(.93);
      opacity: 0;
      pointer-events: none;
    }
    .screen.slide-out-right {
      transition:
        transform .38s cubic-bezier(.4,0,.6,1),
        opacity   .38s cubic-bezier(.4,0,.6,1);
      transform: translateX(100%) scale(.96);
      opacity: 0;
      pointer-events: none;
    }
    /* Entry from left (back navigation) */
    .screen.enter-from-left {
      transform: translateX(-28%) scale(.93);
      opacity: 0;
    }

    /* ‚îÄ‚îÄ Screen content ‚Äî stagger children ‚îÄ‚îÄ */
    .screen-content {
      width: 100%;
      max-width: 380px;
      text-align: center;
    }

    /* Stagger entrance ‚Äî each direct child animates in */
    .screen.slide-in .screen-content > * {
      animation: fadeUp .45s cubic-bezier(.22,.68,0,1.2) both;
    }
    .screen.slide-in .screen-content > *:nth-child(1) { animation-delay: .08s; }
    .screen.slide-in .screen-content > *:nth-child(2) { animation-delay: .14s; }
    .screen.slide-in .screen-content > *:nth-child(3) { animation-delay: .20s; }
    .screen.slide-in .screen-content > *:nth-child(4) { animation-delay: .26s; }
    .screen.slide-in .screen-content > *:nth-child(5) { animation-delay: .30s; }
    .screen.slide-in .screen-content > *:nth-child(6) { animation-delay: .34s; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ Screen Icon ‚îÄ‚îÄ */
    .icon {
      width: 76px; height: 76px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      margin: 0 auto 28px;
      display: flex; align-items: center; justify-content: center;
      font-size: 38px;
      box-shadow: 0 8px 32px rgba(212,175,55,.28);
      animation: iconPulse 3s ease-in-out infinite;
    }
    @keyframes iconPulse {
      0%,100% { box-shadow: 0 8px 32px rgba(212,175,55,.28); }
      50%      { box-shadow: 0 8px 48px rgba(212,175,55,.45); }
    }

    /* ‚îÄ‚îÄ Titles ‚îÄ‚îÄ */
    .title {
      font-family: 'Playfair Display', serif;
      font-size: 30px;
      font-weight: 600;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #fff 0%, var(--gold-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      font-size: 15px;
      color: var(--text-sub);
      margin-bottom: 36px;
      line-height: 1.55;
      font-weight: 300;
    }

    /* ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ */
    .field-wrap { margin-bottom: 20px; }

    .field-label {
      display: block;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .field {
      width: 100%;
      padding: 22px 24px;
      font-size: 28px;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      text-align: center;
      background: var(--glass);
      border: 1.5px solid var(--border);
      border-radius: 22px;
      color: var(--text);
      outline: none;
      transition: border-color .25s, box-shadow .25s, background .25s;
      -webkit-appearance: none;
    }
    .field::placeholder { color: var(--text-muted); font-weight: 400; }
    .field:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 4px rgba(212,175,55,.14);
      background: rgba(255,255,255,.08);
    }

    .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 10px;
    }

    /* Two-column input row */
    .two-col { display: flex; gap: 14px; margin-bottom: 20px; }
    .two-col .field-wrap { flex: 1; margin-bottom: 0; }
    .two-col .field { font-size: 22px; padding: 18px 16px; }

    /* Food grid */
    .food-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }
    .food-cell {
      background: var(--glass);
      border: 1.5px solid var(--border);
      border-radius: 18px;
      padding: 16px 12px 14px;
      transition: border-color .25s;
    }
    .food-cell:focus-within { border-color: var(--gold); }
    .food-cell label {
      display: block;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: .8px;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .food-cell input {
      width: 100%;
      background: transparent;
      border: none;
      font-size: 26px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      color: var(--text);
      text-align: center;
      outline: none;
      -webkit-appearance: none;
    }
    .food-cell input::placeholder { color: var(--text-muted); font-weight: 400; }

    .small-field { font-size: 20px !important; padding: 16px 20px !important; }

    /* ‚îÄ‚îÄ Buttons ‚îÄ‚îÄ */
    .btn {
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 17px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: transform .15s, opacity .15s, box-shadow .2s;
      display: block;
      width: 100%;
      padding: 20px;
      -webkit-appearance: none;
    }
    .btn:active { transform: scale(.97); opacity: .92; }

    .btn-gold {
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      color: var(--bg);
      box-shadow: 0 6px 24px rgba(212,175,55,.3);
    }
    .btn-gold:active { box-shadow: 0 2px 10px rgba(212,175,55,.2); }

    .btn-ghost {
      background: var(--glass);
      border: 1.5px solid var(--glass-border);
      color: var(--text-sub);
    }

    /* Row of buttons */
    .btn-row {
      display: flex;
      gap: 12px;
      margin-top: 28px;
    }
    .btn-row .btn-gold { flex: 1; }
    .btn-back {
      flex: none !important;
      width: 56px !important;
      padding: 0 !important;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    /* ‚îÄ‚îÄ Error ‚îÄ‚îÄ */
    .err {
      color: #ff6b72;
      font-size: 13px;
      margin-top: 14px;
      display: none;
      animation: shake .45s ease;
    }
    .err.show { display: block; }
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%,60%  { transform: translateX(-6px); }
      40%,80%  { transform: translateX(6px); }
    }

    /* ‚îÄ‚îÄ Result screen ‚îÄ‚îÄ */
    .result-num {
      font-family: 'Playfair Display', serif;
      font-size: 110px;
      font-weight: 700;
      line-height: 1;
      margin-bottom: 4px;
      background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .result-unit {
      font-size: 22px;
      color: var(--text-sub);
      margin-bottom: 6px;
    }
    .result-raw {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 40px;
    }
    .edit-link {
      margin-top: 16px;
      font-size: 14px;
      color: var(--text-muted);
      text-decoration: underline;
      cursor: pointer;
      display: inline-block;
    }

    /* ‚îÄ‚îÄ Swipe hint ‚îÄ‚îÄ */
    .swipe-hint {
      position: fixed;
      bottom: calc(16px + env(safe-area-inset-bottom));
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: var(--text-muted);
      z-index: 200;
      opacity: 0;
      transition: opacity .4s;
      pointer-events: none;
      white-space: nowrap;
    }
    .swipe-hint.show { opacity: 1; }

    audio { display: none; }

    /* ‚îÄ‚îÄ Responsive tweaks ‚îÄ‚îÄ */
    @media (max-height: 680px) {
      .icon { width: 60px; height: 60px; font-size: 30px; margin-bottom: 20px; }
      .title { font-size: 24px; }
      .subtitle { font-size: 14px; margin-bottom: 24px; }
      .field { padding: 16px 20px; font-size: 24px; border-radius: 18px; }
      .btn  { padding: 17px; }
      .result-num { font-size: 80px; }
    }
    @media (max-height: 568px) {
      .icon { width: 50px; height: 50px; font-size: 26px; margin-bottom: 14px; }
      .title { font-size: 20px; }
      .subtitle { font-size: 13px; margin-bottom: 18px; }
      .field { padding: 14px 16px; font-size: 20px; }
      .result-num { font-size: 60px; }
    }
  </style>
</head>
<body>
  <div class="bg-glow"></div>
  <audio id="unlockSound" src="shitbro.mp3" preload="auto"></audio>

  <!-- Dot progress -->
  <div class="dots" id="dots">
    <div class="dot" data-step="1"></div>
    <div class="dot" data-step="2"></div>
    <div class="dot" data-step="3"></div>
    <div class="dot" data-step="4"></div>
    <div class="dot" data-step="5"></div>
  </div>

  <!-- Lock -->
  <button class="lock-btn" id="lockBtn" aria-label="L√•s">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2">
      <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
    </svg>
  </button>

  <!-- Swipe hint -->
  <div class="swipe-hint" id="swipeHint">Swipe for at navigere</div>

  <div class="screens" id="screens">

    <!-- ‚ñë LOGIN ‚ñë -->
    <div class="screen slide-in" id="s-login">
      <div class="screen-content">
        <div class="icon">üç∫</div>
        <h1 class="title">Dav Fyr</h1>
        <p class="subtitle">Indtast din adgangskode for at forts√¶tte</p>
        <div class="field-wrap">
          <input class="field" type="password" id="pw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off" />
        </div>
        <button class="btn btn-gold" id="unlockBtn">L√•s op</button>
        <p class="err" id="pwErr">Forkert adgangskode. Pr√∏v igen.</p>
      </div>
    </div>

    <!-- ‚ñë 1 ¬∑ Vol% ‚ñë -->
    <div class="screen" id="s-1">
      <div class="screen-content">
        <div class="icon">üçª</div>
        <h1 class="title">Alkohol&shy;procent</h1>
        <p class="subtitle">Hvad er den gennemsnitlige Vol% p√• det du drikker i aften?</p>
        <div class="field-wrap">
          <input class="field" id="vol" type="text" inputmode="decimal" placeholder="5.0" />
          <p class="hint">F.eks. 4.6 for en klassisk pilsner</p>
        </div>
        <div class="btn-row">
          <button class="btn btn-gold" id="n1">N√¶ste ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- ‚ñë 2 ¬∑ M√∏detid ‚ñë -->
    <div class="screen" id="s-2">
      <div class="screen-content">
        <div class="icon">‚è∞</div>
        <h1 class="title">M√∏detid</h1>
        <p class="subtitle">Hvorn√•r skal du m√∏de ind p√• kontoret i morgen?</p>
        <div class="two-col">
          <div class="field-wrap">
            <label class="field-label">Time</label>
            <input class="field" id="ath" type="text" inputmode="numeric" placeholder="9" />
          </div>
          <div class="field-wrap">
            <label class="field-label">Minut</label>
            <input class="field" id="atm" type="text" inputmode="numeric" placeholder="00" />
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost btn-back" id="b2">‚Üê</button>
          <button class="btn btn-gold" id="n2">N√¶ste ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- ‚ñë 3 ¬∑ S√∏vn ‚ñë -->
    <div class="screen" id="s-3">
      <div class="screen-content">
        <div class="icon">üò¥</div>
        <h1 class="title">S√∏vn</h1>
        <p class="subtitle">Hvor mange timer regner du med at sove i nat?</p>
        <div class="field-wrap">
          <input class="field" id="sleep" type="text" inputmode="decimal" placeholder="7" />
          <p class="hint">Timer fra du l√¶gger dig til du st√•r op</p>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost btn-back" id="b3">‚Üê</button>
          <button class="btn btn-gold" id="n3">N√¶ste ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- ‚ñë 4 ¬∑ Mad ‚ñë -->
    <div class="screen" id="s-4">
      <div class="screen-content">
        <div class="icon">üçñ</div>
        <h1 class="title">Mad</h1>
        <p class="subtitle">Hvad har du spist i dag?</p>
        <div class="food-grid">
          <div class="food-cell">
            <label>K√∏d</label>
            <input id="meat" type="text" inputmode="decimal" placeholder="0" />
          </div>
          <div class="food-cell">
            <label>Br√∏d</label>
            <input id="bread" type="text" inputmode="decimal" placeholder="0" />
          </div>
          <div class="food-cell">
            <label>Gr√∏nt</label>
            <input id="greens" type="text" inputmode="decimal" placeholder="0" />
          </div>
          <div class="food-cell">
            <label>Frugt</label>
            <input id="fruit" type="text" inputmode="decimal" placeholder="0" />
          </div>
        </div>
        <div class="field-wrap">
          <label class="field-label">Flydende kost</label>
          <input class="field small-field" id="liquid" type="text" inputmode="decimal" placeholder="0" />
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost btn-back" id="b4">‚Üê</button>
          <button class="btn btn-gold" id="n4">N√¶ste ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- ‚ñë 5 ¬∑ Vand ‚ñë -->
    <div class="screen" id="s-5">
      <div class="screen-content">
        <div class="icon">üíß</div>
        <h1 class="title">Vand</h1>
        <p class="subtitle">Hvor mange glas vand drikker du i aften?</p>
        <div class="field-wrap">
          <input class="field" id="water" type="text" inputmode="decimal" placeholder="0" />
          <p class="hint">1 glas ‚âà 200 ml</p>
        </div>
        <div class="btn-row">
          <button class="btn btn-ghost btn-back" id="b5">‚Üê</button>
          <button class="btn btn-gold" id="n5">Beregn üç∫</button>
        </div>
      </div>
    </div>

    <!-- ‚ñë RESULT ‚ñë -->
    <div class="screen" id="s-result">
      <div class="screen-content">
        <div class="icon">üéâ</div>
        <div class="result-num" id="resNum">0</div>
        <div class="result-unit">genstande</div>
        <div class="result-raw" id="resRaw"></div>
        <button class="btn btn-gold" id="restartBtn">Pr√∏v igen</button>
        <span class="edit-link" id="editBtn">Ret mine svar</span>
      </div>
    </div>

  </div>

  <script>
  (() => {
    const PASS = "bajerforfandenda";
    const KEY  = "hobby_calc_unlocked";

    // ‚îÄ‚îÄ Screen order ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const ORDER = ['login','1','2','3','4','5','result'];
    let current = 'login';

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const $ = id => document.getElementById(id);
    const el = id => document.querySelector('#' + id);

    function parseNum(v) {
      const s = String(v ?? '').trim().replace(/\s+/g,'').replace(',','.');
      if (!s) return null;
      const n = Number(s);
      return isFinite(n) ? n : null;
    }

    function roundHalf(x) {
      if (!isFinite(x)) return NaN;
      return x >= 0 ? Math.floor(x + .5) : Math.ceil(x - .5);
    }

    // ‚îÄ‚îÄ Calculation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calc() {
      const vRaw   = parseNum($('vol').value)    || 0;
      const ath    = parseNum($('ath').value)    || 0;
      const atm    = parseNum($('atm').value)    || 0;
      const sleep  = parseNum($('sleep').value)  || 0;
      const meat   = parseNum($('meat').value)   || 0;
      const bread  = parseNum($('bread').value)  || 0;
      const greens = parseNum($('greens').value) || 0;
      const fruit  = parseNum($('fruit').value)  || 0;
      const liquid = parseNum($('liquid').value) || 0;
      const water  = parseNum($('water').value)  || 0;

      const v = vRaw > 1 ? vRaw / 100 : vRaw;
      if (v <= 0) return { result: 0, raw: 0 };

      const D7 = .06 / v;
      const F10 = ((ath - 9) + 9/9 - 1) + atm/60;
      const B8 = (5 + F10) + (sleep - 7) / 2;
      const K8 = (meat*1-1) + (bread*.2-1) + (greens*.15-1) + (fruit*.1-1) + (liquid*.2-1);
      const B11 = (B8 + K8 + (water/3 - 1)) * D7;

      return { result: roundHalf(B11), raw: Math.round(B11 * 100) / 100 };
    }

    // ‚îÄ‚îÄ Animated number counter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function animateNumber(el, target) {
      const duration = 900;
      const start = performance.now();
      const from  = 0;
      const diff  = target - from;

      function frame(now) {
        const t  = Math.min((now - start) / duration, 1);
        const ease = 1 - Math.pow(1 - t, 3); // ease-out-cubic
        const cur = Math.round(from + diff * ease);
        el.textContent = cur;
        if (t < 1) requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    // ‚îÄ‚îÄ Screen transition ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function go(to, dir = 'forward') {
      if (to === current) return;

      // Dismiss keyboard
      document.activeElement?.blur();

      const fromEl = $('s-' + current);
      const toEl   = $('s-' + to);

      // Strip all state classes from both
      [fromEl, toEl].forEach(e => {
        e.classList.remove('slide-in','slide-out-left','slide-out-right','enter-from-left');
      });

      if (dir === 'forward') {
        // Outgoing ‚Üí slide left
        fromEl.classList.add('slide-out-left');
        // Incoming starts right, then slides in
        toEl.classList.add('slide-in');
      } else {
        // Outgoing ‚Üí slide right
        fromEl.classList.add('slide-out-right');
        // Incoming comes from the left
        toEl.classList.add('enter-from-left');
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            toEl.classList.remove('enter-from-left');
            toEl.classList.add('slide-in');
          });
        });
      }

      current = to;
      updateChrome();

      // Auto-focus first input on new screen after transition
      setTimeout(() => {
        const inp = toEl.querySelector('input');
        if (inp && to !== 'login' && to !== 'result') inp.focus();
      }, 420);
    }

    // ‚îÄ‚îÄ Dots + chrome ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateChrome() {
      const dotsEl  = $('dots');
      const lockBtn = $('lockBtn');
      const hint    = $('swipeHint');
      const isApp   = (current !== 'login' && current !== 'result');
      const stepNum = parseInt(current);

      dotsEl.classList.toggle('visible', isApp);
      lockBtn.classList.toggle('visible', current !== 'login');

      // Show swipe hint briefly on first app screen
      if (current === '1') {
        hint.classList.add('show');
        setTimeout(() => hint.classList.remove('show'), 2200);
      }

      if (isApp) {
        document.querySelectorAll('.dot').forEach(d => {
          const s = parseInt(d.dataset.step);
          d.classList.remove('active','done');
          if (s === stepNum) d.classList.add('active');
          else if (s < stepNum) d.classList.add('done');
        });
      }
    }

    // ‚îÄ‚îÄ Swipe gesture ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let touchX0 = null, touchY0 = null, swiping = false;

    document.addEventListener('touchstart', e => {
      touchX0 = e.touches[0].clientX;
      touchY0 = e.touches[0].clientY;
      swiping = false;
    }, { passive: true });

    document.addEventListener('touchmove', e => {
      if (touchX0 === null) return;
      const dx = e.touches[0].clientX - touchX0;
      const dy = e.touches[0].clientY - touchY0;
      if (!swiping && Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 8) {
        swiping = true;
      }
    }, { passive: true });

    document.addEventListener('touchend', e => {
      if (!swiping || touchX0 === null) { touchX0 = null; return; }
      const dx = e.changedTouches[0].clientX - touchX0;
      touchX0 = null; swiping = false;

      if (current === 'login' || current === 'result') return;
      // Only swipe if not focused in an input
      if (document.activeElement && document.activeElement.tagName === 'INPUT') return;

      if (dx < -50) {
        // Swipe left ‚Üí next
        navigate('forward');
      } else if (dx > 50) {
        // Swipe right ‚Üí back
        navigate('back');
      }
    });

    function navigate(dir) {
      const idx = ORDER.indexOf(current);
      if (dir === 'forward' && idx < ORDER.length - 2) go(ORDER[idx + 1], 'forward');
      if (dir === 'back'    && idx > 1)                go(ORDER[idx - 1], 'back');
    }

    // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function tryUnlock() {
      const ok = $('pw').value === PASS;
      $('pwErr').classList.toggle('show', !ok);
      if (!ok) return;
      try {
        const s = $('unlockSound');
        s.loop = true; s.currentTime = 0; s.play();
      } catch(_) {}
      localStorage.setItem(KEY, '1');
      go('1', 'forward');
    }

    function lock() {
      localStorage.removeItem(KEY);
      // Reset all screens
      ORDER.forEach(id => {
        const e = $('s-' + id);
        if (!e) return;
        e.classList.remove('slide-in','slide-out-left','slide-out-right','enter-from-left');
      });
      $('s-login').classList.add('slide-in');
      current = 'login';
      updateChrome();
      $('pw').value = '';
    }

    // ‚îÄ‚îÄ Result ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showResult() {
      const r = calc();
      go('result', 'forward');
      setTimeout(() => {
        animateNumber($('resNum'), r.result);
        $('resRaw').textContent = 'Uafrundet: ' + r.raw;
      }, 200);
    }

    // ‚îÄ‚îÄ Wire up buttons ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    $('unlockBtn').onclick = tryUnlock;
    $('pw').onkeydown = e => { if (e.key === 'Enter') tryUnlock(); };
    $('lockBtn').onclick = lock;

    $('n1').onclick = () => go('2','forward');
    $('n2').onclick = () => go('3','forward');
    $('n3').onclick = () => go('4','forward');
    $('n4').onclick = () => go('5','forward');
    $('n5').onclick = () => showResult();

    $('b2').onclick = () => go('1','back');
    $('b3').onclick = () => go('2','back');
    $('b4').onclick = () => go('3','back');
    $('b5').onclick = () => go('4','back');

    $('restartBtn').onclick = () => {
      ['vol','ath','atm','sleep','meat','bread','greens','fruit','liquid','water']
        .forEach(id => $('s-result') && ($( id ).value = ''));
      go('1','back');
    };
    $('editBtn').onclick = () => go('5','back');

    // Enter-key on single-field screens
    $('vol').onkeydown   = e => { if (e.key==='Enter') $('n1').click(); };
    $('sleep').onkeydown = e => { if (e.key==='Enter') $('n3').click(); };
    $('water').onkeydown = e => { if (e.key==='Enter') $('n5').click(); };

    // ‚îÄ‚îÄ Auto-unlock ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (localStorage.getItem(KEY) === '1') {
      $('s-login').classList.remove('slide-in');
      $('s-1').classList.add('slide-in');
      current = '1';
      updateChrome();
    }
  })();
  </script>
</body>
</html>
