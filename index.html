<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hvor mange genstande må du drikke?</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #d4af37;
      --gold-light: #f4d03f;
      --gold-dark: #b8860b;
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --bg-card-hover: rgba(255, 255, 255, 0.06);
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.5);
      --border: rgba(212, 175, 55, 0.2);
      --border-hover: rgba(212, 175, 55, 0.4);
      --shadow-gold: 0 0 40px rgba(212, 175, 55, 0.15);
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* Animated background */
    .bg-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }

    .bg-animation::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 20% 20%, rgba(212, 175, 55, 0.08) 0%, transparent 50%),
                  radial-gradient(ellipse at 80% 80%, rgba(212, 175, 55, 0.05) 0%, transparent 50%),
                  radial-gradient(ellipse at 40% 60%, rgba(184, 134, 11, 0.03) 0%, transparent 40%);
      animation: bgFloat 20s ease-in-out infinite;
    }

    @keyframes bgFloat {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(2%, 2%) rotate(1deg); }
      66% { transform: translate(-1%, 1%) rotate(-1deg); }
    }

    /* Floating particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--gold);
      border-radius: 50%;
      opacity: 0;
      animation: particleFloat 15s infinite;
    }

    .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .particle:nth-child(2) { left: 20%; animation-delay: 2s; }
    .particle:nth-child(3) { left: 30%; animation-delay: 4s; }
    .particle:nth-child(4) { left: 40%; animation-delay: 6s; }
    .particle:nth-child(5) { left: 50%; animation-delay: 8s; }
    .particle:nth-child(6) { left: 60%; animation-delay: 10s; }
    .particle:nth-child(7) { left: 70%; animation-delay: 1s; }
    .particle:nth-child(8) { left: 80%; animation-delay: 3s; }
    .particle:nth-child(9) { left: 90%; animation-delay: 5s; }

    @keyframes particleFloat {
      0% { transform: translateY(100vh) scale(0); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(-100vh) scale(1); opacity: 0; }
    }

    /* Container */
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    /* Gate / Login Screen */
    #gate {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    .gate-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 60px 48px;
      text-align: center;
      max-width: 440px;
      width: 100%;
      box-shadow: var(--shadow-gold), 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .gate-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      border-radius: 50%;
      margin: 0 auto 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      box-shadow: 0 10px 40px rgba(212, 175, 55, 0.3);
      animation: pulse 3s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 10px 40px rgba(212, 175, 55, 0.3); }
      50% { box-shadow: 0 10px 60px rgba(212, 175, 55, 0.5); }
    }

    .gate-title {
      font-family: 'Playfair Display', serif;
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--gold-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .gate-subtitle {
      color: var(--text-secondary);
      font-size: 15px;
      margin-bottom: 36px;
      font-weight: 300;
    }

    .input-group {
      position: relative;
      margin-bottom: 24px;
    }

    .input-group input {
      width: 100%;
      padding: 18px 24px;
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 16px;
      color: var(--text-primary);
      transition: all 0.3s ease;
      outline: none;
    }

    .input-group input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
      background: rgba(255, 255, 255, 0.08);
    }

    .input-group input::placeholder {
      color: var(--text-muted);
    }

    .btn-primary {
      width: 100%;
      padding: 18px 32px;
      font-size: 16px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
      border: none;
      border-radius: 16px;
      color: var(--bg-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 40px rgba(212, 175, 55, 0.4);
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .error-msg {
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 16px;
      display: none;
      animation: shake 0.5s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    /* Main App */
    #app {
      display: none;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 48px;
      padding-top: 20px;
    }

    .header h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 600;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--gold-light) 50%, var(--text-primary) 100%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: shimmer 3s linear infinite;
    }

    @keyframes shimmer {
      to { background-position: 200% center; }
    }

    .header p {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 300;
    }

    /* Cards */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 24px;
      padding: 32px;
      margin-bottom: 24px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--gold), transparent);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .card:hover {
      border-color: var(--border-hover);
      transform: translateY(-4px);
      box-shadow: var(--shadow-gold);
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-title {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      font-weight: 500;
      margin-bottom: 24px;
      color: var(--gold-light);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .card-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: linear-gradient(180deg, var(--gold), var(--gold-dark));
      border-radius: 2px;
    }

    /* Form Layout */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 24px;
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .form-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Form Row */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 140px;
      gap: 16px;
      align-items: center;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .form-row:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .form-row label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 400;
      transition: color 0.3s ease;
    }

    .form-row:hover label {
      color: var(--text-primary);
    }

    .form-row input {
      width: 100%;
      padding: 14px 18px;
      font-size: 16px;
      font-family: 'Inter', sans-serif;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      transition: all 0.3s ease;
      outline: none;
      text-align: right;
    }

    .form-row input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
      background: rgba(255, 255, 255, 0.08);
    }

    @media (max-width: 500px) {
      .form-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .form-row input {
        text-align: left;
      }
    }

    /* Help Panel */
    .help-panel {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(212, 175, 55, 0.05) 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      height: fit-content;
      position: sticky;
      top: 24px;
    }

    .help-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 500;
      color: var(--gold-light);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .help-body {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.7;
      min-height: 60px;
    }

    /* Buttons */
    .btn-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .btn-secondary {
      padding: 14px 24px;
      font-size: 14px;
      font-weight: 500;
      font-family: 'Inter', sans-serif;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      border-color: var(--gold);
      color: var(--gold);
      background: rgba(212, 175, 55, 0.1);
    }

    /* Result Card */
    .result-card {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0.05) 100%);
      border: 1px solid var(--gold);
      position: relative;
    }

    .result-card::after {
      content: '';
      position: absolute;
      inset: -1px;
      border-radius: 24px;
      padding: 1px;
      background: linear-gradient(135deg, var(--gold), transparent, var(--gold));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
      opacity: 0.5;
    }

    .result-main {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 4vw, 36px);
      font-weight: 600;
      text-align: center;
      margin-bottom: 8px;
      background: linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .result-detail {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 24px;
    }

    .result-error {
      text-align: center;
      color: #ff6b6b;
      font-size: 14px;
      margin-top: 12px;
    }

    /* Accordion / Details */
    details {
      margin-top: 20px;
      border-top: 1px solid var(--glass-border);
      padding-top: 16px;
    }

    summary {
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      padding: 8px 0;
      transition: color 0.3s ease;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    summary::-webkit-details-marker {
      display: none;
    }

    summary::before {
      content: '+';
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    details[open] summary::before {
      content: '-';
      background: var(--gold);
      border-color: var(--gold);
      color: var(--bg-primary);
    }

    summary:hover {
      color: var(--gold);
    }

    .debug-content {
      margin-top: 16px;
      padding: 16px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: var(--text-muted);
      white-space: pre-wrap;
      line-height: 1.8;
    }

    /* Audio element hidden */
    audio {
      display: none;
    }

    /* Responsive */
    @media (max-width: 640px) {
      .container {
        padding: 24px 16px;
      }
      .card {
        padding: 24px 20px;
      }
      .gate-card {
        padding: 40px 24px;
      }
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--gold);
    }

    /* Selection */
    ::selection {
      background: rgba(212, 175, 55, 0.3);
      color: var(--text-primary);
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  <div class="particles">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <audio id="unlockSound" src="shitbro.mp3" preload="auto"></audio>

  <!-- Gate / Login -->
  <div id="gate">
    <div class="gate-card">
      <div class="gate-logo">
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
          <path d="M2 17l10 5 10-5"/>
          <path d="M2 12l10 5 10-5"/>
        </svg>
      </div>
      <h2 class="gate-title">Premium Adgang</h2>
      <p class="gate-subtitle">Indtast din adgangskode for at fortsætte</p>
      <div class="input-group">
        <input type="password" id="pw" placeholder="Adgangskode" autocomplete="off" />
      </div>
      <button class="btn-primary" id="unlock">Lås op</button>
      <p class="error-msg" id="pwErr">Forkert adgangskode. Prøv igen.</p>
    </div>
  </div>

  <!-- Main Application -->
  <div id="app">
    <div class="container">
      <header class="header">
        <h1>Genstands&shy;beregner</h1>
        <p>Beregn dit anbefalede indtag baseret på dine parametre</p>
      </header>

      <div class="card">
        <h2 class="card-title">Indtast dine oplysninger</h2>
        <div class="form-grid">
          <div class="form-section">
            <div class="form-row">
              <label for="vol">Gennemsnitlig Vol%</label>
              <input id="vol" data-help="Indtast den gennemsnitlige alkoholprocent for dine drikkevarer (f.eks. 5.5 for øl)" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="ath">Aktivitetstidspunkt (time)</label>
              <input id="ath" data-help="Indtast timen hvor du har dit første møde/aktivitet næste dag (f.eks. 9 for kl. 09:00)" inputmode="numeric" value="0" />
            </div>
            <div class="form-row">
              <label for="atm">Aktivitetstidspunkt (minut)</label>
              <input id="atm" data-help="Indtast minuttet for dit første møde næste dag (f.eks. 30 for kl. 09:30)" inputmode="numeric" value="0" />
            </div>
            <div class="form-row">
              <label for="sleep">Antal sovetimer</label>
              <input id="sleep" data-help="Indtast hvor mange timers søvn du forventer at få mellem festen og næste dag" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="meat">Spist kød (portioner)</label>
              <input id="meat" data-help="Indtast antal portioner kød du har spist (1 portion = ca. 200g)" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="bread">Spist brød (stk)</label>
              <input id="bread" data-help="Indtast antal stykker brød du har spist" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="greens">Spist grønt (portioner)</label>
              <input id="greens" data-help="Indtast antal portioner grøntsager du har spist" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="fruit">Spist frugt (stk)</label>
              <input id="fruit" data-help="Indtast antal stykker frugt du har spist" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="liquid">Flydende kost (portioner)</label>
              <input id="liquid" data-help="Indtast antal portioner flydende kost du har indtaget (1 portion = ca. 200g)" inputmode="decimal" value="0" />
            </div>
            <div class="form-row">
              <label for="water">Drukket vand (glas)</label>
              <input id="water" data-help="Indtast antal glas vand du drikker i løbet af aftenen (1 glas = ca. 200ml)" inputmode="decimal" value="0" />
            </div>

            <div class="btn-group">
              <button class="btn-secondary" id="reset">Nulstil</button>
              <button class="btn-secondary" id="lock">Lås</button>
            </div>
          </div>

          <div class="help-panel">
            <h3 class="help-title">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                <line x1="12" y1="17" x2="12.01" y2="17"/>
              </svg>
              Hjælp
            </h3>
            <div class="help-body" id="helpPanel">
              Klik på et felt for at se en detaljeret forklaring her.
            </div>
          </div>
        </div>
      </div>

      <div class="card result-card">
        <div class="result-main" id="out">Resultat: —</div>
        <div class="result-detail" id="detail"></div>
        <div class="result-error" id="err"></div>

        <details>
          <summary>Vis mellemregninger</summary>
          <div class="debug-content" id="debug"></div>
        </details>

        <details>
          <summary>Avancerede konstanter</summary>
          <div class="debug-content">
Fast antal (B6): 5
Base vol (D6): 6%
Base time (F6): 9
Base sleep (I6): 7
Food weights (K6–O6): 1; 0,2; 0,15; 0,1; 0,2
Water weight (Q6): 1/3
          </div>
        </details>
      </div>
    </div>
  </div>

  <script>
    // Hobby passcode
    const EXPECTED_PASSCODE = "bajerforfandenda";
    const STORAGE_KEY = "hobby_calc_unlocked";

    function parseLocaleNumber(raw) {
      const s = String(raw ?? "").trim()
        .replace(/\s+/g, "")
        .replace(",", ".");
      if (s === "") return null;
      const n = Number(s);
      return Number.isFinite(n) ? n : null;
    }

    function roundHalfAwayFromZero(x) {
      if (!Number.isFinite(x)) return NaN;
      if (x >= 0) return Math.floor(x + 0.5);
      return Math.ceil(x - 0.5);
    }

    function getInputs() {
      const volRaw = parseLocaleNumber(document.getElementById("vol").value);
      const ath = parseLocaleNumber(document.getElementById("ath").value);
      const atm = parseLocaleNumber(document.getElementById("atm").value);
      const sleep = parseLocaleNumber(document.getElementById("sleep").value);
      const meat = parseLocaleNumber(document.getElementById("meat").value);
      const bread = parseLocaleNumber(document.getElementById("bread").value);
      const greens = parseLocaleNumber(document.getElementById("greens").value);
      const fruit = parseLocaleNumber(document.getElementById("fruit").value);
      const liquid = parseLocaleNumber(document.getElementById("liquid").value);
      const water = parseLocaleNumber(document.getElementById("water").value);

      if ([volRaw, ath, atm, sleep, meat, bread, greens, fruit, liquid, water].some(v => v === null)) {
        return { error: "Udfyld alle felter med tal." };
      }

      const volFraction = (volRaw > 1) ? (volRaw / 100) : volRaw;
      return { volFraction, ath, atm, sleep, meat, bread, greens, fruit, liquid, water };
    }

    function calculate(x) {
      // Constants from the sheet
      const B6 = 5;
      const D6 = 0.06;
      const F6 = 9;
      const G6 = 0;
      const I6 = 7;

      const K6 = 1;
      const L6 = 0.2;
      const M6 = 0.15;
      const N6 = 0.1;
      const O6 = 0.2;

      const Q6 = 1/3;

      // Mirrors the Excel formulas exactly
      const D7 = D6 / x.volFraction;

      const F7 = x.ath - F6;
      const F8 = F6 / 9;
      const F9 = (F7 + F8) - 1;
      const G7 = x.atm / 60;
      const G8 = G6 / 60;
      const G9 = G7 + G8;
      const F10 = F9 + G9;

      const B7 = B6 + F10;

      const I7 = x.sleep - I6;
      const I8 = I7 / 2;
      const B8 = B7 + I8;

      const K7 = x.meat * K6 - 1;
      const L7 = x.bread * L6 - 1;
      const M7 = x.greens * M6 - 1;
      const N7 = x.fruit * N6 - 1;
      const O7 = x.liquid * O6 - 1;
      const K8 = K7 + L7 + M7 + N7 + O7;

      const B9 = B8 + K8;

      const Q7 = x.water * Q6 - 1;
      const B10 = B9 + Q7;

      const B11 = B10 * D7;

      const result = roundHalfAwayFromZero(B11);

      return { result, B11, B10, B9, B8, B7, D7, F10, I8, K8, Q7 };
    }

    function render() {
      const errEl = document.getElementById("err");
      const outEl = document.getElementById("out");
      const detailEl = document.getElementById("detail");
      const dbgEl = document.getElementById("debug");

      errEl.textContent = "";
      detailEl.textContent = "";

      const inputs = getInputs();
      if (inputs.error) {
        outEl.textContent = "Resultat: —";
        errEl.textContent = inputs.error;
        dbgEl.textContent = "";
        return;
      }

      if (inputs.volFraction <= 0) {
        outEl.textContent = "Resultat: —";
        errEl.textContent = "Gns. Vol% skal være større end 0.";
        dbgEl.textContent = "";
        return;
      }

      const r = calculate(inputs);

      if (!Number.isFinite(r.result)) {
        outEl.textContent = "Resultat: —";
        errEl.textContent = "Kunne ikke beregne (tjek input).";
        dbgEl.textContent = "";
        return;
      }

      outEl.textContent = r.result + " genstande";
      detailEl.textContent = "Uafrundet værdi: " + (Math.round(r.B11 * 1000) / 1000).toString();

      dbgEl.textContent =
        "B7 (aktivitet): " + r.B7 + "\n" +
        "I8 (søvn): " + r.I8 + "\n" +
        "K8 (mad): " + r.K8 + "\n" +
        "Q7 (vand): " + r.Q7 + "\n" +
        "B10 (før vol%): " + r.B10 + "\n" +
        "D7 (vol% faktor): " + r.D7 + "\n" +
        "B11 (endelig): " + r.B11;
    }

    function setUnlocked(unlocked) {
      if (unlocked) localStorage.setItem(STORAGE_KEY, "1");
      else localStorage.removeItem(STORAGE_KEY);

      document.getElementById("gate").style.display = unlocked ? "none" : "flex";
      document.getElementById("app").style.display = unlocked ? "block" : "none";
    }

    function tryUnlock() {
      const pw = document.getElementById("pw").value;
      const ok = pw === EXPECTED_PASSCODE;
      document.getElementById("pwErr").style.display = ok ? "none" : "block";
      if (ok) {
        const snd = document.getElementById("unlockSound");
        if (snd) {
          try {
            snd.loop = true;
            snd.onended = () => { try { snd.currentTime = 0; snd.play(); } catch (e) {} };
            snd.currentTime = 0;
            snd.play();
          } catch (e) {}
        }
        setUnlocked(true);
        render();
      }
    }

    document.getElementById("unlock").addEventListener("click", tryUnlock);
    document.getElementById("pw").addEventListener("keydown", (e) => {
      if (e.key === "Enter") tryUnlock();
    });

    document.getElementById("lock").addEventListener("click", () => setUnlocked(false));

    document.getElementById("reset").addEventListener("click", () => {
      const ids = ["vol","ath","atm","sleep","meat","bread","greens","fruit","liquid","water"];
      ids.forEach(id => document.getElementById(id).value = "0");
      render();
    });

    // Recalc on any input change
    const ids = ["vol","ath","atm","sleep","meat","bread","greens","fruit","liquid","water"];
    ids.forEach(id => {
      document.getElementById(id).addEventListener("input", render);
    });

    // Contextual help panel
    const helpPanel = document.getElementById("helpPanel");
    function setHelpFor(el) {
      if (!helpPanel || !el) return;
      const helpTxt = el.getAttribute("data-help") || "";
      if (helpTxt) {
        helpPanel.textContent = helpTxt;
      }
    }
    ids.forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("focus", () => setHelpFor(el));
      el.addEventListener("click", () => setHelpFor(el));
      el.addEventListener("touchstart", () => setHelpFor(el), { passive: true });
    });

    // Auto-unlock if previously unlocked
    setUnlocked(localStorage.getItem(STORAGE_KEY) === "1");
    if (localStorage.getItem(STORAGE_KEY) === "1") render();
  </script>
</body>
</html>
